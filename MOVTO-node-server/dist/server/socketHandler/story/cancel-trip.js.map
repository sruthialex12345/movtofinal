{"version":3,"sources":["server/socketHandler/story/cancel-trip.js"],"names":["cancelTripHandler","socket","on","tripObj","cb","console","log","riderID","riderId","driverID","driverId","TripID","tripId","currentDate","Date","toISOString","pickUpTime","TripSchema","findOneAsync","_id","then","tripData","tripStatus","cancelTrip","applyCancellationRules","SocketStore","emitByUserId","catch","error","timeDifference","diff","chargeCancellationFees","tripAmt","percentage","paymentCtrl","cardPayment","status","findByIdAndUpdateAsync","$set","paymentStatus","updatedTripObj"],"mappings":"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","file":"cancel-trip.js","sourceRoot":"../../../../../../.."}