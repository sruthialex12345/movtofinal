{"version":3,"sources":["server/socketHandler/story/start-trip.js"],"names":["getConfig","resolve","reject","AppConfig","findOneAsync","key","then","foundDetails","value","catch","err","startTripHandler","socket","on","tripRequestObj","cb","riderID","riderId","driverID","driverId","tripRequestStatus","tripObj","TripSchema","srcLoc","destLoc","pickUpAddress","destAddress","paymentMode","pickUpTime","passengerIds","saveAsync","tripId","savedTrip","_id","TripRequest","findOneAndUpdateAsync","$set","error","SocketStore","emitByUserId","e","UserSchema","updateAsync","$or","currTripId","currTripState","new","multi","notifyUserBySmsOfPickUpAndDrop","returnObj","message","data","console","log","tripStatus","riderRatingByDriver","driverRatingByRider","bookingTime","now","Date","toISOString","travelTime","moment","duration","diff","Math","abs","email","onEndTripRider","onEndTripDriver","sms","updateUserRating","paymentCtrl","cardPayment","paymentStatus","status","updatedTripObject","updatedTripObj","aggregateAsync","$match","$gt","$group","userRt","$avg","res","length","userRating","toFixed","driverReviewByRider","type","findOne","populate","exec","passengerName","smsText","forEach","item","index","passengerList","element","fname","slice","sendSmsToRider","userId"],"mappings":"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","file":"start-trip.js","sourceRoot":"../../../../../../.."}